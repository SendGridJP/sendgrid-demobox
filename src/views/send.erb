<div class="container-fluid">
  <div class="row">
    <div class="col-md-3">

      <form id="param" class="form-horizontal">

        <div class="form-group">
          <div class="col-md-12">
            <label class="control-label"><span class="text-danger">*</span>To</label>
          </div>
          <div class="col-md-12">
            <input type="text" name="tos" class="form-control"
              placeholder="recipient1@address.com, recipient2@address.com"
              value="awwa500@gmail.com,awwa502@gmail.com" />
          </div>
        </div>

        <div class="form-group">
          <div class="col-md-12">
            <label class="control-label"><span class="text-danger">*</span>From</label>
          </div>
          <div class="col-md-12">
            <input type="text" name="from" class="form-control"
              placeholder="your@address.com"
              value="awwa500@gmail.com">
          </div>
        </div>

        <div class="form-group">
          <div class="col-md-12">
            <label class="control-label"><span class="text-danger">*</span>件名</label>
          </div>
          <div class="col-md-12">
            <input type="text" name="subject" class="form-control"
              placeholder="-name-さんへ　テストメール"
              value="-name-さんへ　テストメール">
          </div>
        </div>

        <div class="form-group">
          <div class="col-md-12">
            <label class="control-label"><span class="text-danger">*</span>本文</label>
          </div>
          <div class="col-md-12">
            <textarea name="body" class="form-control" style="height:100px;"
              placeholder="-name-さんへ　テスト本文">-name-さんへ　テスト本文
<a href="https://sendgrid.com">センドグリッド</a></textarea>
          </div>
        </div>

        <div class="panel-group" id="accordion">
          <div class="panel panel-default">
            <div class="panel-heading">
              <h4 class="panel-title">
                <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne">
                  <i class="glyphicon glyphicon-chevron-right"></i>オプション
                </a>
              </h4>
            </div>
          </div>
          <div id="collapseOne" class="panel-collapse collapse">
            <div class="panel-body">

              <div class="form-group">
                <div class="col-md-12">
                  <label>
                    <input type="checkbox" id="usesub" name="usesub" value="true">Substitution
                  </label>
                </div>
                <div class="col-md-12">
                  <input type="text" id="subkey" name="subkey" class="form-control"
                    placeholder="-name-" value="-name-" disabled="true">
                </div>
                <div class="col-md-12">
                  <input type="text" id="subval" name="subval" class="form-control"
                    placeholder="田中, 鈴木" value="田中, 鈴木" disabled="true">
                </div>
              </div>

              <div class="form-group">
                <div class="col-md-12">
                  <label>
                    <input type="checkbox" id="usebcc" name="usebcc" value="true">Bcc
                  </label>
                </div>
                <div class="col-md-12">
                  <input type="text" id="bcc" name="bcc" class="form-control"
                    placeholder="bcc@address.com" value="awwa501@gmail.com" disabled="true">
                </div>
              </div>

              <div class="form-group">
                <div class="col-md-12">
                  <label>
                    <input type="checkbox" id="usecategory" name="usecategory"
                      value="true">Category
                  </label>
                </div>
                <div class="col-md-12">
                  <input type="text" id="category" name="category" class="form-control"
                    placeholder="sendgrid-demo" value="sendgrid-demo" disabled="true">
                </div>
              </div>

              <div class="form-group">
                <div class="col-md-12">
                  <label>
                    <input type="checkbox" id="useuniqueargs" name="useuniqueargs"
                      value="true">Unique Args
                  </label>
                </div>
                <div class="col-md-12">
                  <input type="text" id="uniquekey" name="uniquekey" class="form-control"
                    placeholder="emailtoken" value="emailtoken" disabled="true">
                  <input type="text" id="uniqueval" name="uniqueval" class="form-control"
                    placeholder="20140901123456" value="20140901123456" disabled="true">
                </div>
              </div>

              <div class="form-group">
                <div class="col-md-12">
                  <label>
                    <input type="checkbox" id="useclick" name="useclick" value="true">Click Tracking
                  </label>
                </div>
              </div>

              <div class="form-group">
                <div class="col-md-12">
                  <label>
                    <input type="checkbox" id="useopen" name="useopen" value="true">Open Tracking
                  </label>
                </div>
              </div>

              <div class="form-group">
                <div class="col-md-12">
                  <label>
                    <input type="checkbox" id="usesubscription" name="usesubscription"
                      value="true">Subscription Tracking
                  </label>
                </div>
              </div>

              <div class="form-group">
                <div class="col-md-12">
                  <label>
                    <input type="checkbox" id="usetemplate" name="usetemplate"
                      value="true">Template
                  </label>
                </div>
                <div class="col-md-12">
                  <select class="form-control" id="template" name="template" disabled="true">
                    <option>Template1</option>
                    <option>Template2</option>
                    <option>Template3</option>
                  </select>
                </div>
              </div>

              <div class="form-group">
                <div class="col-md-12">
                  <label>
                    <input type="checkbox" id="usefooter" name="usefooter"
                      value="true">Footer
                  </label>
                </div>
              </div>

            </div>
          </div>
        </div>

      </form>

      <button id="send" class="btn btn-primary center-block">送信</button>


      <div id="result"></div>
    </div>

    <div class="col-md-9">

      <div class="btn-group" data-toggle="buttons-radio" style="margin-bottom:15px;">
        <button class="btn btn-default" id="show-table">Table</button>
        <button class="btn btn-default active" id="show-json">JSON</button>
      </div>

      <table class="table table-striped table-bordered table-condensed" id="event-table">
        <thead>
          <tr>
            <th>email</th>
            <th>smtp-id</th>
            <th>timestamp</th>
            <th>response</th>
            <th>sg_event_id</th>
            <th>sg_message_id</th>
            <th>event</th>
            <th>useragent</th>
            <th>ip</th>
            <th>attempt</th>
            <th>category</th>
            <th>url</th>
            <th>status</th>
            <th>reason</th>
            <th>type</th>
            <th>send_at</th>
          </tr>
        </thead>
        <tbody>
        </tbody>
      </table>

      <table class="table table-striped table-bordered table-condensed" id="event-json">
        <thead>
          <tr><th>JSON</th><tr>
        </thead>
        <tbody>
        </tbody>
      </table>
    </div>

  </div>
</div>

<script src="http://code.jquery.com/jquery.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script src="<%= rocketio_js %>"></script>
<script>
  $(function(){

    // 初期状態
    $("#event-table").hide();
    $("#nav-send").addClass("active");
    $("#nav-receive").removeClass("active");

    $("#test").click(
      function(){
        $("#event-json").prepend("<tr><td>test</td></tr>");
      }
    );

    getRow = function(event){
      var email = ("email" in event)? event["email"] : "";
      var smtp_id = ("smtp-id" in event)? event["smtp-id"] : "";
      var timestamp = ("timestamp" in event)? event["timesamp"] : "";
      var response = ("response" in event)? event["response"] : "";
      var sg_event_id = ("sg_event_id" in event)? event["sg_event_id"] : "";
      var sg_message_id = ("sg_message_id" in event)? event["sg_message_id"] : "";
      var event_type = ("event" in event)? event["event"] : "";
      var useragent = ("useragent" in event)? event["useragent"] : "";
      var ip = ("ip" in event)? event["ip"] : "";
      var attempt = ("attempt" in event)? event["attempt"] : "";
      var category = ("category" in event)? event["category"] : "";
      var url = ("url" in event)? event["url"] : "";
      var status = ("status" in event)? event["status"] : "";
      var reason = ("reason" in event)? event["reason"] : "";
      var type = ("type" in event)? event["type"] : "";
      var send_at = ("send_at" in event)? event["send_at"] : "";
      var row = "<tr>";
      row += "<td>" + email + "</td>";
      row += "<td>" + smtp_id + "</td>";
      row += "<td>" + timestamp + "</td>";
      row += "<td>" + response + "</td>";
      row += "<td>" + sg_event_id + "</td>";
      row += "<td>" + sg_message_id + "</td>";
      row += "<td>" + event_type + "</td>";
      row += "<td>" + useragent + "</td>";
      row += "<td>" + ip + "</td>";
      row += "<td>" + attempt + "</td>";
      row += "<td>" + category + "</td>";
      row += "<td>" + url + "</td>";
      row += "<td>" + status + "</td>";
      row += "<td>" + reason + "</td>";
      row += "<td>" + type + "</td>";
      row += "<td>" + send_at + "</td>";
      row += "</tr>";
      return row;
    }

    io = new RocketIO().connect(); // WebSocketとCometの適当な方が使われる
    io.on("event", function(value){
      var event = JSON.parse(value);
      $("#event-table").prepend(getRow(event));
      $("#event-json").prepend("<tr><td>"+value+"</td></tr>");
    });

    $("#send").click(
      function(){
        $("#result").html("sending...")
        var param = $("#param").serializeArray();
        $.post(
          "/send",
          JSON.stringify(param),
          function(data) {
            $("#result").html(data);
          }
        );
      }
    );

    $("#usesub").click(
      function(){
        var checked = $("#usesub:checked").val() == "true";
        $("#subkey").attr("disabled", !checked);
        $("#subval").attr("disabled", !checked);
      }
    );

    $("#usebcc").click(
      function(){
        var checked = $("#usebcc:checked").val() == "true";
        $("#bcc").attr("disabled", !checked);
      }
    );

    $("#usecategory").click(
      function(){
        var checked = $("#usecategory:checked").val() == "true";
        $("#category").attr("disabled", !checked);
      }
    );

    $("#useuniqueargs").click(
      function(){
        var checked = $("#useuniqueargs:checked").val() == "true";
        $("#uniquekey").attr("disabled", !checked);
        $("#uniqueval").attr("disabled", !checked);
      }
    );

    $("#usetemplate").click(
      function(){
        var checked = $("#usetemplate:checked").val() == "true";
        $("#template").attr("disabled", !checked);
      }
    );

    $("#show-table").click(
      function(){
        $("#event-table").show(200);
        $("#event-json").hide();
        $("#show-json").removeClass("active");
      }
    );

    $("#show-json").click(
      function(){
        $("#event-table").hide();
        $("#event-json").show(200);
        $("#show-table").removeClass("active");
      }
    );

  });
</script>
